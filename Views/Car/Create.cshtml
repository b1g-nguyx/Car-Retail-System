@model CarViewModel

@{
    ViewData["Title"] = "Create";
}

<h1 class="text-center mb-4">Create Car</h1>

<div class="card shadow-lg p-4">
    <div class="card-body">
        <h4 class="card-title text-primary">Car Information</h4>
        <hr />

        <form id="carForm" asp-action="Create" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label asp-for="BrandId" class="form-label fw-bold"></label>
                    <select asp-for="BrandId" class="form-select"
                        asp-items="@(new SelectList(Model.Brands, "Id", "Name"))"></select>
                </div>
                <div class="col-md-6 mb-3">
                    <label asp-for="CategoryId" class="form-label fw-bold"></label>
                    <select asp-for="CategoryId" class="form-select"
                        asp-items="@(new SelectList(Model.Categories, "Id", "Name"))"></select>
                </div>

                <div class="col-md-6 mb-3">
                    <label asp-for="Model" class="form-label fw-bold"></label>
                    <input asp-for="Model" class="form-control" />
                    <span asp-validation-for="Model" class="text-danger"></span>
                </div>
                <div class="col-md-6 mb-3">
                    <label asp-for="Year" class="form-label fw-bold"></label>
                    <input asp-for="Year" class="form-control" />
                    <span asp-validation-for="Year" class="text-danger"></span>
                </div>

                <div class="col-md-6 mb-3">
                    <label asp-for="PricePerDay" class="form-label fw-bold"></label>
                    <input asp-for="PricePerDay" class="form-control" />
                    <span asp-validation-for="PricePerDay" class="text-danger"></span>
                </div>

                <div class="col-md-6 mb-3">
                    <label asp-for="Availability" class="form-label fw-bold">Status</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" asp-for="Availability" value="true" checked />
                        <label class="form-check-label">Active</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" asp-for="Availability" value="false" />
                        <label class="form-check-label">Inactive</label>
                    </div>
                </div>

                <div class="col-md-12 mb-3">
                    <label asp-for="Description" class="form-label fw-bold"></label>
                    <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                    <span asp-validation-for="Description" class="text-danger"></span>
                </div>

                <div class="col-md-6 mb-3">
                    <label asp-for="LicensePlates" class="form-label fw-bold"></label>
                    <input asp-for="LicensePlates" class="form-control" />
                    <span asp-validation-for="LicensePlates" class="text-danger"></span>
                </div>
                <div class="col-md-6 mb-3">
                    <label asp-for="Kilometers" class="form-label fw-bold"></label>
                    <input asp-for="Kilometers" class="form-control" />
                    <span asp-validation-for="Kilometers" class="text-danger"></span>
                </div>

                <div class="col-md-6 mb-3">
                    <label asp-for="FuelType" class="form-label fw-bold"></label>
                    <select asp-for="FuelType" class="form-select">
                        <option value="">Select Fuel Type</option>
                        <option value="Gasoline">Gasoline</option>
                        <option value="Diesel">Diesel</option>
                        <option value="Electric">Electric</option>
                        <option value="Hybrid">Hybrid</option>
                    </select>
                    <span asp-validation-for="FuelType" class="text-danger"></span>
                </div>
                <div class="col-md-6 mb-3">
                    <label asp-for="Transmission" class="form-label fw-bold"></label>
                    <select asp-for="Transmission" class="form-select">
                        <option value="">Select Transmission</option>
                        <option value="Automatic">Automatic</option>
                        <option value="Manual">Manual</option>
                    </select>
                    <span asp-validation-for="Transmission" class="text-danger"></span>
                </div>

                <div class="col-md-6 mb-3">
                    <label asp-for="Seats" class="form-label fw-bold"></label>
                    <input asp-for="Seats" class="form-control" />
                    <span asp-validation-for="Seats" class="text-danger"></span>
                </div>

                <!-- Dropzone Upload Images -->
                <div class="col-md-12 mb-3">
                    <label class="form-label fw-bold">Upload Images</label>
                    <div id="dropzoneForm" class="dropzone border rounded p-3 text-center">
                        <div class="dz-message">Drag and drop files here or click to upload</div>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between mt-3">
                <a asp-action="Index" class="btn btn-outline-secondary">Back to List</a>
                <button type="submit" class="btn btn-primary">Create</button>
            </div>
        </form>
    </div>
</div>

<!-- Dropzone.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js"></script>

<script>
    Dropzone.autoDiscover = false;

    var myDropzone = new Dropzone("#dropzoneForm", {
        url: "#",
        autoProcessQueue: false,
        acceptedFiles: "image/*",
        addRemoveLinks: true,
        dictRemoveFile: "Remove",
        init: function () {
            let dz = this;

            document.querySelector("#carForm").addEventListener("submit", function (e) {
                e.preventDefault();

                let formData = new FormData(this);
                dz.files.forEach((file, index) => {
                    formData.append("files", file, file.name);
                });

                fetch(this.action, {
                    method: "POST",
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    alert("Car created successfully!");
                    window.location.href = "/Car/Index";
                })
                .catch(error => console.error("Error:", error));
            });

            dz.on("addedfile", function (file) {
                console.log("File added:", file.name);
            });

            dz.on("removedfile", function (file) {
                console.log("File removed:", file.name);
            });
        }
    });
</script>
